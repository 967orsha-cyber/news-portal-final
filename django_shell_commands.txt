# === 1. –ò–º–ø–æ—Ä—Ç ===
from django.contrib.auth.models import User
from news.models import Author, Category, Post, Comment

# === 2. –°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∞–≤—Ç–æ—Ä–æ–≤ ===
user1 = User.objects.create_user('ivan')
user2 = User.objects.create_user('petr')

author1 = Author.objects.create(user=user1, rating=0)
author2 = Author.objects.create(user=user2, rating=0)
print("‚úì –°–æ–∑–¥–∞–Ω—ã –∞–≤—Ç–æ—Ä—ã: ivan, petr")

# === 3. –°–æ–∑–¥–∞—ë–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ===
cat1 = Category.objects.create(name='–°–ø–æ—Ä—Ç')
cat2 = Category.objects.create(name='–ü–æ–ª–∏—Ç–∏–∫–∞')
cat3 = Category.objects.create(name='–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ')
cat4 = Category.objects.create(name='–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏')
print("‚úì –°–æ–∑–¥–∞–Ω—ã 4 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏")

# === 4. –°–æ–∑–¥–∞—ë–º —Å—Ç–∞—Ç—å–∏ –∏ –Ω–æ–≤–æ—Å—Ç—å ===
article1 = Post.objects.create(
    author=author1,
    post_type=Post.ARTICLE,
    title='–ü–µ—Ä–≤–∞—è —Å—Ç–∞—Ç—å—è –æ —Å–ø–æ—Ä—Ç–µ',
    content='–û—á–µ–Ω—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Å—Ç–∞—Ç—å—è –æ —Ñ—É—Ç–±–æ–ª–µ. –†–µ–¥–∏—Å–∫–∞ ‚Äî –ø–ª–æ—Ö–æ–π –∏–≥—Ä–æ–∫.'
)

article2 = Post.objects.create(
    author=author2,
    post_type=Post.ARTICLE,
    title='–í—Ç–æ—Ä–∞—è —Å—Ç–∞—Ç—å—è –æ –ø–æ–ª–∏—Ç–∏–∫–µ',
    content='–ê–Ω–∞–ª–∏–∑ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏. –ù–µ—Ö–æ—Ä–æ—à–∏–π –ø–æ–ª–∏—Ç–∏–∫.'
)

news1 = Post.objects.create(
    author=author1,
    post_type=Post.NEWS,
    title='–ù–æ–≤–æ—Å—Ç—å –æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö',
    content='–í—ã—à–ª–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è Python. –†–µ–¥–∏—Å–∫–∞ ‚Äî –ø–ª–æ—Ö–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç.'
)
print("‚úì –°–æ–∑–¥–∞–Ω—ã 2 —Å—Ç–∞—Ç—å–∏ –∏ 1 –Ω–æ–≤–æ—Å—Ç—å")

# === 5. –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ===
article1.categories.add(cat1, cat2)  # –°–ø–æ—Ä—Ç + –ü–æ–ª–∏—Ç–∏–∫–∞
article2.categories.add(cat2)        # –ü–æ–ª–∏—Ç–∏–∫–∞
news1.categories.add(cat4)           # –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
print("‚úì –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏—Å–≤–æ–µ–Ω—ã")

# === 6. –°–æ–∑–¥–∞—ë–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ===
comment1 = Comment.objects.create(post=article1, user=user1, text='–û—Ç–ª–∏—á–Ω–∞—è —Å—Ç–∞—Ç—å—è!')
comment2 = Comment.objects.create(post=article1, user=user2, text='–°–æ–≥–ª–∞—Å–µ–Ω —Å –∞–≤—Ç–æ—Ä–æ–º')
comment3 = Comment.objects.create(post=news1, user=user2, text='–ñ–¥—É –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è')
comment4 = Comment.objects.create(post=article2, user=user1, text='–°–ø–æ—Ä–Ω–æ–µ –º–Ω–µ–Ω–∏–µ')
print("‚úì –°–æ–∑–¥–∞–Ω—ã 4 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è")

# === 7. –°—Ç–∞–≤–∏–º –ª–∞–π–∫–∏/–¥–∏—Å–ª–∞–π–∫–∏ ===
article1.like(); article1.like(); article1.dislike()  # +1
news1.like(); news1.like(); news1.like()             # +3
comment1.like(); comment1.like(); comment1.dislike() # +1
comment2.dislike()                                   # -1
print("‚úì –õ–∞–π–∫–∏/–¥–∏—Å–ª–∞–π–∫–∏ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω—ã")

# === 8. –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥–∏ –∞–≤—Ç–æ—Ä–æ–≤ ===
author1.update_rating()
author2.update_rating()
print("‚úì –†–µ–π—Ç–∏–Ω–≥–∏ –∞–≤—Ç–æ—Ä–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω—ã")

# === 9. –õ—É—á—à–∏–π –∞–≤—Ç–æ—Ä ===
best_author = Author.objects.order_by('-rating').values('user__username', 'rating').first()
print(f"\nüìä –õ–£–ß–®–ò–ô –ê–í–¢–û–†: {best_author}")

# === 10. –õ—É—á—à–∞—è —Å—Ç–∞—Ç—å—è ===
best_post = Post.objects.filter(post_type=Post.ARTICLE).order_by('-rating').first()
print(f"\nüèÜ –õ–£–ß–®–ê–Ø –°–¢–ê–¢–¨–Ø:")
print(f"   –î–∞—Ç–∞: {best_post.created_at.date()}")
print(f"   –ê–≤—Ç–æ—Ä: {best_post.author.user.username}")
print(f"   –†–µ–π—Ç–∏–Ω–≥: {best_post.rating}")
print(f"   –ó–∞–≥–æ–ª–æ–≤–æ–∫: {best_post.title}")
print(f"   –ü—Ä–µ–≤—å—é: {best_post.preview()}")

# === 11. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ª—É—á—à–µ–π —Å—Ç–∞—Ç—å–µ ===
comments = Comment.objects.filter(post=best_post).order_by('created_at')
print(f"\nüí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å—Ç–∞—Ç—å–µ '{best_post.title}':")
for c in comments:
    print(f"   - {c.created_at.date()}, {c.user.username}, —Ä–µ–π—Ç–∏–Ω–≥ {c.rating}: {c.text[:50]}...")

print("\n‚úÖ –í–°–Å –í–´–ü–û–õ–ù–ï–ù–û!")